CREATE OR REPLACE PROCEDURE
             MES_MRB_GET_ID(TTYPE IN VARCHAR2, TRES OUT VARCHAR2) AS
C_YEAR	VARCHAR2(1);
C_DAY	VARCHAR2(4);
C_VALUE  NUMBER;
C_SDAY VARCHAR2(4);

BEGIN
   SELECT TO_CHAR(SYSDATE, 'Y')  INTO C_YEAR FROM DUAL;
   SELECT LPAD(TO_CHAR(SYSDATE, 'MMDD'),4,0) INTO C_DAY FROM DUAL;

   IF C_YEAR = '0' THEN C_YEAR := 'A';
   ELSIF C_YEAR = '1' THEN C_YEAR := 'B';
   ELSIF C_YEAR = '2' THEN C_YEAR := 'C';
   ELSIF C_YEAR = '3' THEN C_YEAR := 'D';
   ELSIF C_YEAR = '4' THEN C_YEAR := 'E';
   ELSIF C_YEAR = '5' THEN C_YEAR := 'F';
   ELSIF C_YEAR = '6' THEN C_YEAR := 'G';
   END IF;

   BEGIN
      SELECT LAST_VALUE, START_DAY INTO C_VALUE, C_SDAY
        FROM SAJET.MES_TO_MRB_BASE WHERE TYPE = TTYPE and ROWNUM = 1;

      IF C_SDAY = C_DAY THEN
         UPDATE SAJET.MES_TO_MRB_BASE SET LAST_VALUE = LAST_VALUE + 1 WHERE TYPE = TTYPE;
         C_VALUE := C_VALUE + 1;
      ELSE
         UPDATE SAJET.MES_TO_MRB_BASE SET LAST_VALUE = 1, START_DAY = C_DAY WHERE TYPE = TTYPE;
         C_VALUE := 1;
      END IF;

      COMMIT;

     
      SELECT TTYPE||C_YEAR||C_DAY||LPAD(C_VALUE,5,0) INTO TRES FROM DUAL;

   EXCEPTION
      WHEN OTHERS THEN
         TRES:='XX';
   END;

EXCEPTION
   WHEN OTHERS THEN
      TRES := 'XX';
END;
/
