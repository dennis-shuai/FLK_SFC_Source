// SajetControl.cpp: implementation of the CSajetControl class.
//
//////////////////////////////////////////////////////////////////////

#include "stdafx.h"
#include "SajetControl.h"

#ifdef _DEBUG
#undef THIS_FILE
static char THIS_FILE[]=__FILE__;
#define new DEBUG_NEW
#endif

//////////////////////////////////////////////////////////////////////
// Construction/Destruction
//////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////
// Construction/Destruction
//////////////////////////////////////////////////////////////////////






//********************************************************************************************************************
//     F U N C T I O N    C H A N G E    R E C O R D S                                                                
//********************************************************************************************************************
//     Date         Owner           Details                                                                           
//    ============================================================================================================    
//     2013.07.15   Jack Lin        Create this function                                                              
//                                                                                                                    
//********************************************************************************************************************
CSajetControl::CSajetControl()
{
	m_hLib				= NULL;

	m_pFSajetTransStart_2	= NULL;
	m_pFSajetTransClose_2	= NULL;
	m_pFSajetTransData_2	= NULL;

}






//********************************************************************************************************************
//     F U N C T I O N    C H A N G E    R E C O R D S                                                                
//********************************************************************************************************************
//     Date         Owner           Details                                                                           
//    ============================================================================================================    
//     2013.07.15   Jack Lin        Create this function                                                              
//                                                                                                                    
//********************************************************************************************************************
CSajetControl::~CSajetControl()
{
	if( m_hLib!=NULL	)
	{
		FreeLibrary(m_hLib);
	}
}






//********************************************************************************************************************
//     F U N C T I O N    C H A N G E    R E C O R D S                                                                
//********************************************************************************************************************
//     Date         Owner           Details                                                                           
//    ============================================================================================================    
//     2013.07.15   Jack Lin        Create this function                                                              
//                                                                                                                    
//********************************************************************************************************************
BOOL CSajetControl::SajetTransStart()
{
	if(m_pFSajetTransStart_2!=NULL)
	{
		return	m_pFSajetTransStart_2();
	}

	return	FALSE;
}






//********************************************************************************************************************
//     F U N C T I O N    C H A N G E    R E C O R D S                                                                
//********************************************************************************************************************
//     Date         Owner           Details                                                                           
//    ============================================================================================================    
//     2013.07.15   Jack Lin        Create this function                                                              
//                                                                                                                    
//********************************************************************************************************************
BOOL CSajetControl::SajetTransClose()
{
	if(m_pFSajetTransClose_2!=NULL)
	{
		return	m_pFSajetTransClose_2();
	}

	return	FALSE;
}






//********************************************************************************************************************
//     F U N C T I O N    C H A N G E    R E C O R D S                                                                
//********************************************************************************************************************
//     Date         Owner           Details                                                                           
//    ============================================================================================================    
//     2013.07.15   Jack Lin        Create this function                                                              
//                                                                                                                    
//********************************************************************************************************************
BOOL CSajetControl::SajetTransData(int iCommandNo, char* pData, int *pLen)
{
	if( m_pFSajetTransData_2!=NULL)
	{
		return	m_pFSajetTransData_2(iCommandNo,pData,pLen);
	}

	return	FALSE;
}







//********************************************************************************************************************
//     F U N C T I O N    C H A N G E    R E C O R D S                                                                
//********************************************************************************************************************
//     Date         Owner           Details                                                                           
//    ============================================================================================================    
//     2013.07.15   Jack Lin        Create this function                                                              
//                                                                                                                    
//********************************************************************************************************************
BOOL CSajetControl::Init()
{
	m_hLib	= LoadLibrary(_T("SajetConnect.dll"));

	if( m_hLib!=NULL)
	{
		m_pFSajetTransStart_2	= (BOOL (__stdcall*)())		GetProcAddress( m_hLib	, "SajetTransStart"	);
		m_pFSajetTransClose_2	= (BOOL (__stdcall*)())		GetProcAddress( m_hLib	, "SajetTransClose"	);
		m_pFSajetTransData_2	= (BOOL (__stdcall*)(int,char*,int*))		GetProcAddress( m_hLib	, "SajetTransData"	);

		return	TRUE;
	}
	else
	{
		AfxMessageBox("Load SajetConnect.dll Error!!!");
	}
	return	FALSE;
}






//********************************************************************************************************************
//     F U N C T I O N    C H A N G E    R E C O R D S                                                                
//********************************************************************************************************************
//     Date         Owner           Details                                                                           
//    ============================================================================================================    
//     2013.07.15   Jack Lin        Create this function                                                              
//                                                                                                                    
//********************************************************************************************************************
BOOL CSajetControl::SendData(int iCommand, CString &szData)
{
	BOOL	bRet	= FALSE;

	char szBuf[MAX_PATH];

	ZeroMemory(szBuf,MAX_PATH);

	int		iLen	= szData.GetLength();

	for(int i=0;i<iLen;i++)
	{
		szBuf[i]	= szData[i];
	}

	if( m_pFSajetTransData_2!=NULL)
	{

		m_pFSajetTransData_2(iCommand,szBuf,&iLen);
	}

//	AfxMessageBox(szBuf);

	szData.Empty();
	szData	= CString(szBuf);

	szData	= szData.Left(iLen);

	return	bRet;
}
