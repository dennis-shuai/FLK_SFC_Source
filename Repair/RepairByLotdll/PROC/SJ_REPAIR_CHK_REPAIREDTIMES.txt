CREATE OR REPLACE PROCEDURE sajet.SJ_REPAIR_CHK_REPAIREDTIMES
(TTYPE IN VARCHAR2,
TRECID IN VARCHAR2,
TSN IN VARCHAR2,
TWO IN VARCHAR2,
TREADONID IN VARCHAR2,
TLOCATION IN VARCHAR2,
TITEMNO IN VARCHAR2, 
TEMPID IN VARCHAR2,
TRES OUT VARCHAR2
)
IS
C_TEMP NUMBER;
BEGIN
    IF TTYPE = 'LOCATION' THEN
       SELECT COUNT(A.SERIAL_NUMBER) INTO C_TEMP FROM SAJET.G_SN_DEFECT A, SAJET.G_SN_REPAIR_LOCATION B 
           WHERE A.WORK_ORDER=TWO AND A.SERIAL_NUMBER=TSN  AND A.RECID=B.RECID 
	          AND B.REASON_ID IS NOT NULL AND B.LOCATION=TLOCATION;
			
	    IF C_TEMP>=2 THEN
	        TRES:='Location('||TLOCATION||') HAS USED '||C_TEMP||' Times OF The SN('||TSN||')';
        ELSE
             TRES := 'OK';
        END IF;
	ELSE 
	  TRES := 'OK'; 
	END IF;
END;
/
